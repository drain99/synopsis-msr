\begin{figure}
\begin{algorithm}[H]
\begin{footnotesize}
\SetAlgoLined
\SetKwProg{Fn}{Function}{}{end}
\Fn{$Reconcile(v:T,\gamma)$}{
  \uIf{$T \keyword{is} scalar$}{
    \lIf{$\gamma \keyword{maps} v$}{\Return{$\gamma[v]$}}
    \lElse{\Return{$Rand(T)$}}
  }
  \Else{
    \uIf{$\gamma \keyword{maps} v \strcat{} tag$}{
      $E^V \mapsfrom \gamma[v]$;\\
      $args \mapsfrom []$;\\
      ${\tt Let}\ [\field{a_1}:T_1, \field{a_2}:T_2,\dots, \field{a_n}:T_n]\ {\tt be\ the\ fields\ of}\ V$.\\
      \ForEach{$(\field{a'}:T') \keyword{in} [\field{a_1}:T_1, \field{a_2}:T_2,\dots, \field{a_n}:T_n]$}{
        $arg \mapsfrom Reconcile(v \strcat{} \field{a'} : T', \gamma)$;\\
        $args.{\tt append}(arg)$;\\
      }
      \Return{$V(args)$};
    }
    \Else{
      \Return{$Rand(T)$};
    }
  }
}
\end{footnotesize}
\caption{\label{algo:reconcile}Pseudocode for Reconciliation Procedure}
\end{algorithm}
\end{figure}